(ns bdnc.experience
  (:require
   [goog.string :as gstring]
   [goog.string.format]
   [re-frame.core :as rf]))

(def expand-icon
  [:svg {:xmlns "http://www.w3.org/2000/svg", :viewBox "0 0 24 24", :aria-hidden "true", :data-slot "icon", :class "w-6 h-6"}
        [:path {:style {:fill "black"}
                :d "M 22.065089,12 A 10.06511,10.06511 0 0 1 12.000051,22.065109 10.06511,10.06511 0 0 1 1.9349112,12 10.06511,10.06511 0 0 1 12.000051,1.9348907 10.06511,10.06511 0 0 1 22.065089,12 Z"}]
        [:path {:style {:fill "white"}
                :d "m 11.459799,7.4983244 h 1.080402 v 3.9614746 h 3.961474 v 1.080402 h -3.961474 v 3.961474 H 11.459799 V 12.540201 H 7.4983249 v -1.080402 h 3.9614741 z"}]])

(def unexpand-icon
  [:svg {:xmlns "http://www.w3.org/2000/svg", :viewBox "0 0 24 24", :aria-hidden "true", :data-slot "icon", :class "w-6 h-6"}
        [:path {:style {:fill "black"}
                :d "M 22.065089,12 A 10.06511,10.06511 0 0 1 12.000051,22.065109 10.06511,10.06511 0 0 1 1.9349112,12 10.06511,10.06511 0 0 1 12.000051,1.9348907 10.06511,10.06511 0 0 1 22.065089,12 Z"}]
        [:path {:style {:fill "white"}
                :d "m 16.501675,11.459799 v 1.080402 c 0,0 -1.003584,0 -9.0033501,0 v -1.080402 c 0,0 1.0035834,0 9.0033501,0 z"}]])

(def comcast-logo
  [:svg {:xmlns "http://www.w3.org/2000/svg", :viewBox "0 0 24 24", :aria-hidden "true", :data-slot "icon"}
        [:path {:stroke-linecap "round", :stroke-linejoin "round", :d "m 14.823748,5.2199321 c -1.145025,-0.016499 -2.302144,0.9390613 -2.391896,2.0676393 -0.05304,0.6757156 -0.04445,0.6859625 0.634691,0.741816 l 0.688829,0.056443 -0.660032,0.6410258 C 12.561497,9.248139 12.456721,9.4550867 12.547617,9.8367 c 0.120607,0.504757 0.364772,2.256561 0.614532,4.414612 0.08547,0.73893 0.255887,1.466056 0.380699,1.615523 0.288561,0.348061 0.540812,0.348002 0.540812,0 0,-0.149406 0.07156,-0.412026 0.158385,-0.583432 0.08723,-0.171404 0.238096,-0.513469 0.335775,-0.760246 0.09768,-0.246776 0.349232,-0.832181 0.559242,-1.301057 l 0.763702,-1.704795 c 0.21001,-0.468876 0.461562,-1.054857 0.559241,-1.301634 0.09809,-0.2467765 0.249526,-0.5888409 0.336352,-0.760246 0.08683,-0.1714037 0.15896,-0.4334512 0.15896,-0.5828553 0,-0.1494127 0.08008,-0.2718459 0.179119,-0.2718459 0.271873,3e-7 0.214104,-1.3104212 -0.08409,-1.9086787 -0.32207,-0.6456576 -1.168155,-1.2944142 -1.872394,-1.4352525 -0.116999,-0.023399 -0.235755,-0.035154 -0.354206,-0.03686 z M 9.3309692,5.4128734 C 8.6814107,5.3978698 8.0406238,5.6962818 7.5288389,6.3044348 6.7886492,7.1842292 6.9053699,8.1867019 8.0414318,10.699464 c 0.5270592,1.165215 1.2293431,2.787077 1.5602312,3.603682 0.482426,1.190033 0.64608,1.439215 0.824752,1.256135 0.24664,-0.253034 0.980501,-5.18153 1.097173,-7.3663255 C 11.597526,6.8060408 11.594656,6.7938043 10.98796,6.1875181 10.48373,5.6831785 9.9041089,5.4261113 9.3309692,5.4128734 Z m 9.9223648,3.3721525 c -0.650499,0.012125 -1.281956,0.2798688 -1.707674,0.7994105 -0.275672,0.3362753 -0.892729,1.5246916 -1.371899,2.6407036 -0.478899,1.116011 -1.102283,2.513803 -1.385146,3.106067 -0.282455,0.592265 -0.56879,1.309937 -0.635266,1.595365 l -0.121524,0.518926 0.563849,-0.332896 c 0.310131,-0.183322 0.564425,-0.396578 0.564425,-0.474002 0,-0.07742 0.08844,-0.141107 0.196973,-0.141107 0.279607,0 4.979044,-3.166782 5.681113,-3.8283 0.526382,-0.49583 0.582855,-0.650301 0.582855,-1.577511 0,-0.90566 -0.06476,-1.0923261 -0.545419,-1.5729031 -0.502165,-0.5022445 -1.171788,-0.745878 -1.822287,-0.733753 z M 4.7971366,8.7971208 C 4.3115227,8.7865153 3.8445395,8.8625021 3.5778646,9.0372895 2.4956603,9.7462325 2.1060545,11.265498 2.7542642,12.248754 c 0.1842343,0.279125 1.818938,1.505544 3.6330546,2.725367 3.098869,2.083416 3.5679736,2.367235 3.5679736,2.156335 0,-0.183529 -1.1125451,-2.871759 -1.7059472,-4.122608 C 7.904485,12.28103 7.622143,11.640598 7.622143,11.58469 7.622143,11.273418 6.6942069,9.5257968 6.3758007,9.2377182 6.0765825,8.966912 5.4214991,8.8107562 4.7971366,8.7971208 Z M 2.8481433,13.939726 c -0.3178784,-0.0053 -0.6002175,0.07948 -0.9243916,0.224618 -1.05819198,0.473754 -1.41223782,1.203345 -1.32812528,2.731127 0.0320155,0.572298 1.06939748,1.689641 1.68002728,1.80904 0.8377342,0.163898 8.0980173,0.03676 8.1536403,-0.142834 0.03052,-0.09871 -1.3935983,-1.139231 -3.1653871,-2.311839 C 4.7040862,14.55552 3.6604998,13.953157 2.8481433,13.939726 Z m 18.5402157,0.01785 c -0.680017,-0.0019 -1.59747,0.5429 -3.500012,1.803857 -1.474277,0.97707 -2.857934,1.966243 -3.075542,2.198379 l -0.395097,0.422166 0.685373,0.10943 c 0.376878,0.06003 2.025285,0.120194 3.66358,0.134195 2.347555,0.02007 3.094988,-0.03214 3.527082,-0.247656 0.794457,-0.39626 1.122515,-1.004715 1.122515,-2.081462 0,-0.854867 -0.06025,-0.987931 -0.72569,-1.621283 -0.482689,-0.459063 -0.836935,-0.716339 -1.302209,-0.717626 z"}]])

(def signalpath-logo
  [:svg {:xmlns "http://www.w3.org/2000/svg", :viewBox "0 0 24 24", :aria-hidden "true", :data-slot "icon"}
        [:path {:stroke-linecap "round", :stroke-linejoin "round", :d "M 11.134766 0.90625 C 10.978599 0.90625 10.853516 1.0313326 10.853516 1.1875 L 10.853516 2.0136719 C 10.853516 2.1698393 10.978599 2.296875 11.134766 2.296875 L 11.960938 2.296875 C 12.117104 2.296875 12.242188 2.1698393 12.242188 2.0136719 L 12.242188 1.1875 C 12.242188 1.0313326 12.117104 0.90625 11.960938 0.90625 L 11.134766 0.90625 z M 7.5214844 1.671875 C 7.3318115 1.671875 7.1796875 1.8239973 7.1796875 2.0136719 L 7.1796875 3.0175781 C 7.1796875 3.2072527 7.3318115 3.359375 7.5214844 3.359375 L 8.5253906 3.359375 C 8.7150634 3.359375 8.8671875 3.2072527 8.8671875 3.0175781 L 8.8671875 2.0136719 C 8.8671875 1.8239973 8.7150634 1.671875 8.5253906 1.671875 L 7.5214844 1.671875 z M 14.796875 2.0253906 C 14.688943 2.0253906 14.601562 2.1127667 14.601562 2.2207031 L 14.601562 2.7910156 C 14.601563 2.8989524 14.688938 2.9863281 14.796875 2.9863281 L 15.367188 2.9863281 C 15.475119 2.9863281 15.5625 2.898952 15.5625 2.7910156 L 15.5625 2.2207031 C 15.5625 2.1127662 15.475124 2.0253906 15.367188 2.0253906 L 14.796875 2.0253906 z M 4.7617188 4.1015625 C 4.5361455 4.1015625 4.3535156 4.2822392 4.3535156 4.5078125 L 4.3535156 5.7011719 C 4.3535156 5.9267416 4.5361455 6.109375 4.7617188 6.109375 L 5.9550781 6.109375 C 6.1806507 6.109375 6.3613281 5.9267416 6.3613281 5.7011719 L 6.3613281 4.5078125 C 6.3613281 4.2822392 6.1806507 4.1015625 5.9550781 4.1015625 L 4.7617188 4.1015625 z M 17.404297 4.96875 C 17.328514 4.96875 17.267578 5.031636 17.267578 5.1074219 L 17.267578 5.5078125 C 17.267578 5.5835945 17.328517 5.6445312 17.404297 5.6445312 L 17.804688 5.6445312 C 17.88047 5.6445312 17.941406 5.5835944 17.941406 5.5078125 L 17.941406 5.1074219 C 17.941406 5.0316364 17.880467 4.96875 17.804688 4.96875 L 17.404297 4.96875 z M 10.951172 6.2070312 C 10.559754 6.2070313 10.246094 6.5226459 10.246094 6.9140625 L 10.246094 8.9824219 C 10.246094 9.3738385 10.559754 9.6894531 10.951172 9.6894531 L 13.021484 9.6894531 C 13.412901 9.6894531 13.728516 9.3738385 13.728516 8.9824219 L 13.728516 6.9140625 C 13.728516 6.5226459 13.412901 6.2070312 13.021484 6.2070312 L 10.951172 6.2070312 z M 14.96875 7.4121094 C 14.621333 7.4121094 14.341797 7.6916445 14.341797 8.0390625 L 14.341797 9.875 C 14.341797 10.222417 14.621333 10.501953 14.96875 10.501953 L 16.804688 10.501953 C 17.152105 10.501953 17.431641 10.222417 17.431641 9.875 L 17.431641 8.0390625 C 17.431641 7.6916445 17.152105 7.4121094 16.804688 7.4121094 L 14.96875 7.4121094 z M 3.859375 7.4902344 C 3.599959 7.4902344 3.390625 7.6976153 3.390625 7.9570312 L 3.390625 9.3300781 C 3.390625 9.5894976 3.599959 9.796875 3.859375 9.796875 L 5.2304688 9.796875 C 5.4898883 9.796875 5.6992188 9.5894976 5.6992188 9.3300781 L 5.6992188 7.9570312 C 5.6992188 7.6976153 5.4898883 7.4902344 5.2304688 7.4902344 L 3.859375 7.4902344 z M 4.4628906 10.560547 C 4.1527034 10.560547 3.9023438 10.810907 3.9023438 11.121094 L 3.9023438 12.761719 C 3.9023437 13.071905 4.1527034 13.320312 4.4628906 13.320312 L 6.1035156 13.320312 C 6.4137028 13.320312 6.6621094 13.071905 6.6621094 12.761719 L 6.6621094 11.121094 C 6.6621094 10.810907 6.4137028 10.560547 6.1035156 10.560547 L 4.4628906 10.560547 z M 17.896484 10.679688 C 17.586297 10.679688 17.337891 10.928095 17.337891 11.238281 L 17.337891 12.878906 C 17.337891 13.189093 17.586297 13.439453 17.896484 13.439453 L 19.537109 13.439453 C 19.847297 13.439453 20.097656 13.189093 20.097656 12.878906 L 20.097656 11.238281 C 20.097656 10.928095 19.847297 10.679688 19.537109 10.679688 L 17.896484 10.679688 z M 7.1953125 13.498047 C 6.8478955 13.498047 6.5683594 13.777582 6.5683594 14.125 L 6.5683594 15.960938 C 6.5683594 16.308355 6.8478955 16.587891 7.1953125 16.587891 L 9.03125 16.587891 C 9.378667 16.587891 9.6582031 16.308355 9.6582031 15.960938 L 9.6582031 14.125 C 9.6582031 13.777582 9.378667 13.498047 9.03125 13.498047 L 7.1953125 13.498047 z M 18.769531 14.203125 C 18.510112 14.203125 18.300781 14.410502 18.300781 14.669922 L 18.300781 16.042969 C 18.300781 16.302384 18.510112 16.509766 18.769531 16.509766 L 20.140625 16.509766 C 20.400041 16.509766 20.609375 16.302384 20.609375 16.042969 L 20.609375 14.669922 C 20.609375 14.410502 20.400041 14.203125 20.140625 14.203125 L 18.769531 14.203125 z M 10.978516 14.310547 C 10.587099 14.310547 10.271484 14.626162 10.271484 15.017578 L 10.271484 17.085938 C 10.271484 17.477354 10.587099 17.792969 10.978516 17.792969 L 13.048828 17.792969 C 13.440246 17.792969 13.753906 17.477354 13.753906 17.085938 L 13.753906 15.017578 C 13.753906 14.626162 13.440246 14.310547 13.048828 14.310547 L 10.978516 14.310547 z M 18.044922 17.890625 C 17.819349 17.890625 17.638672 18.073258 17.638672 18.298828 L 17.638672 19.492188 C 17.638672 19.71776 17.819349 19.898438 18.044922 19.898438 L 19.238281 19.898438 C 19.463854 19.898438 19.646484 19.71776 19.646484 19.492188 L 19.646484 18.298828 C 19.646484 18.073258 19.463854 17.890625 19.238281 17.890625 L 18.044922 17.890625 z M 6.1953125 18.355469 C 6.1195294 18.355469 6.0585938 18.416408 6.0585938 18.492188 L 6.0585938 18.892578 C 6.0585938 18.968362 6.1195296 19.03125 6.1953125 19.03125 L 6.5957031 19.03125 C 6.6714859 19.03125 6.7324219 18.968368 6.7324219 18.892578 L 6.7324219 18.492188 C 6.7324219 18.416407 6.671486 18.355469 6.5957031 18.355469 L 6.1953125 18.355469 z M 15.474609 20.640625 C 15.284937 20.640625 15.132812 20.792748 15.132812 20.982422 L 15.132812 21.986328 C 15.132813 22.176003 15.284937 22.328125 15.474609 22.328125 L 16.478516 22.328125 C 16.668188 22.328125 16.820312 22.176003 16.820312 21.986328 L 16.820312 20.982422 C 16.820313 20.792748 16.668188 20.640625 16.478516 20.640625 L 15.474609 20.640625 z M 8.6132812 21.013672 C 8.5147973 21.023613 8.4375 21.107794 8.4375 21.208984 L 8.4375 21.779297 C 8.4375 21.887236 8.5248754 21.974609 8.6328125 21.974609 L 9.203125 21.974609 C 9.3110616 21.974609 9.3984375 21.887234 9.3984375 21.779297 L 9.3984375 21.208984 C 9.3984375 21.101045 9.3110617 21.013672 9.203125 21.013672 L 8.6328125 21.013672 C 8.6260664 21.013672 8.6198468 21.013009 8.6132812 21.013672 z M 12.039062 21.703125 C 11.882896 21.703125 11.757812 21.83016 11.757812 21.986328 L 11.757812 22.8125 C 11.757812 22.968667 11.882896 23.09375 12.039062 23.09375 L 12.865234 23.09375 C 13.021401 23.09375 13.146484 22.968667 13.146484 22.8125 L 13.146484 21.986328 C 13.146484 21.83016 13.021401 21.703125 12.865234 21.703125 L 12.039062 21.703125 z"}]])

(def ici-logo
  [:svg {:xmlns "http://www.w3.org/2000/svg", :viewBox "0 0 24 24", :aria-hidden "true", :data-slot "icon"}
        [:path {:style {:fill-opacity "1"} :stroke-linecap "round", :stroke-linejoin "round", :d "M 7.5373375,2.6389228 11.971219,4.9761474 V 10.500579 L 7.5373375,8.112947 Z"}]
        [:path {:style {:fill-opacity "0.66"} :stroke-linecap "round", :stroke-linejoin "round", :d "M 7.5373375,8.112947 11.971219,10.500579 7.5373375,12.972096 3.1963261,10.567728 Z"}]
        [:path {:style {:fill-opacity "0.33"} :stroke-linecap "round", :stroke-linejoin "round", :d "M 7.5373375,2.6389228 V 8.1381505 L 3.1963261,10.567728 3.289196,4.8785305 Z"}]
        [:path {:style {:fill-opacity "1"} :stroke-linecap "round", :stroke-linejoin "round", :d "m 17.866613,7.660158 2.937061,1.5482078 V 12.86782 l -2.937061,-1.581598 z"}]
        [:path {:style {:fill-opacity "0.66"} :stroke-linecap "round", :stroke-linejoin "round", :d "m 17.866613,11.286222 2.937061,1.581598 -2.937061,1.637165 -2.875542,-1.592684 z"}]
        [:path {:style {:fill-opacity "0.33"} :stroke-linecap "round", :stroke-linejoin "round", :d "m 17.866613,7.660158 v 3.64276 l -2.875542,1.609383 0.06152,-3.7685979 z"}]
        [:path {:style {:fill-opacity "1"} :stroke-linecap "round", :stroke-linejoin "round", :d "m 10.94881,15.273192 2.612263,1.376997 v 3.25477 L 10.94881,18.498264 Z"}]
        [:path {:style {:fill-opacity "0.66"} :stroke-linecap "round", :stroke-linejoin "round", :d "m 10.94881,18.498264 2.612263,1.406695 -2.612263,1.456118 -2.557547,-1.416556 z"}]
        [:path {:style {:fill-opacity "0.33"} :stroke-linecap "round", :stroke-linejoin "round", :d "m 10.94881,15.273192 v 3.239921 l -2.557547,1.431408 0.054715,-3.351843 z"}]])

(def comcast {:name "comcast"
              :path "https://www.todo.com"
              :title "software developer"
              :details ["yabadi yabado", "yada yada yada", "yahoo yahoo tang"]
              :logo comcast-logo})

(def signalpath {:name "signalpath"
                 :path "https://www.todo.com"
                 :title "master chief"
                 :details ["yabadi yabado", "yada yada yada", "yahoo yahoo tang"]
                 :logo signalpath-logo})

(def icidigital {:name "icidigital"
                 :path "https://www.todo.com"
                 :title "master chief supreme"
                 :details ["yabadi yabado", "yada yada yada", "yahoo yahoo tang"]
                 :logo ici-logo})

(def items-all {:comcast comcast
                :signalpath signalpath
                :icidigital icidigital})

(defn expand-button [props, details-id]
  (let [visible? @(rf/subscribe [:visible? details-id])]
    [:button (assoc props
                    :on-click (fn []
                                (rf/dispatch [:visible? details-id])))
     (if visible?
       unexpand-icon
       expand-icon)]))

(defn main-section [props, details-id, company, role, logo]
  [:div.main-section props
   [:div {:class ["flex", "flex-col"]}
    [:div {:class ["text-5xl", "text-[#f9eac4]", "font-bold"]}
     company]
    [:div {:class ["font-light"]}
     role]
    [expand-button {} details-id]]
   [:div {:class ["flex", "flex-col", "justify-center"]}
    [:div {:class ["w-20", "h-20", "fill-slate-600"]}
     logo]]])

(defn details-section [props, details-id, company, details]
  (let [visible? @(rf/subscribe [:visible? details-id])]
    [:div.details-section (conj props
                                {:class ["overflow-hidden"
                                         "transition-all"
                                         "duration-300"
                                         "ease-in-out"
                                         (if visible?
                                           "h-32"
                                           "h-0")]})
     [:ol {:class ["flex", "flex-col", "gap-2", "list-disc", "list-inside"]}
      (for [[i, detail] (map-indexed vector details)
            :let [id (gstring/format "detail-item-%s-%i"
                                     company
                                     i)]]
        [:li {:key id} detail])]]))
(defn component [props]
  [:div#experience
   props
   [:ul {:class ["flex", "flex-col", "gap-8"]}
    (for [[item-id, item] items-all
          :let [company (:name item)
                role (:title item)
                details (:details item)
                path (:path item)
                id (gstring/format "%s-item" (name item-id))
                details-id (keyword (gstring/format "%s-item-details" (name item-id)))
                logo (:logo item)]]
      [:li {:key id}
       [main-section {:class ["flex", "w-[20rem]", "justify-between"]}
        details-id
        company
        role
        logo]
       [details-section {:id (name details-id)}
        details-id
        company
        details]])]])
